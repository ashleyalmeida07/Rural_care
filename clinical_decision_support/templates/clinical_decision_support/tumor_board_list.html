{% extends 'base.html' %}
{% block title %}Tumor Board Sessions{% endblock %}

{% block content %}
<div class="min-h-screen bg-background py-8 fade-in">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-foreground">Multidisciplinary Tumor Board</h1>
                    <p class="text-muted-foreground mt-1">Collaborative treatment planning with specialist consensus</p>
                </div>
                <a href="{% url 'clinical_decision_support:tumor_board_create' %}" 
                   class="inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Create Session
                </a>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-card border border-border/50 rounded-xl p-4 mb-6">
            <form method="get" class="flex flex-wrap gap-4 items-end">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium text-muted-foreground mb-1">Status</label>
                    <select name="status" class="w-full px-3 py-2 bg-background border border-border rounded-lg text-foreground">
                        <option value="">All Statuses</option>
                        {% for value, label in status_choices %}
                        <option value="{{ value }}" {% if selected_status == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex items-center space-x-2">
                    <input type="checkbox" name="my_sessions" id="my_sessions" class="rounded border-border" {% if my_sessions %}checked{% endif %}>
                    <label for="my_sessions" class="text-sm text-muted-foreground">My Sessions Only</label>
                </div>
                <button type="submit" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors">
                    <i class="fas fa-filter mr-2"></i>Filter
                </button>
            </form>
        </div>

        <!-- Sessions List -->
        <div class="space-y-4">
            {% for session in page_obj %}
            <div class="bg-card border border-border/50 rounded-xl p-6 hover:shadow-lg transition-all duration-300">
                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <div class="w-10 h-10 rounded-lg flex items-center justify-center
                                {% if session.status == 'consensus_achieved' %}bg-green-100 dark:bg-green-900/30
                                {% elif session.status == 'in_review' %}bg-amber-100 dark:bg-amber-900/30
                                {% else %}bg-blue-100 dark:bg-blue-900/30{% endif %}">
                                <i class="fas fa-users-medical 
                                    {% if session.status == 'consensus_achieved' %}text-green-600
                                    {% elif session.status == 'in_review' %}text-amber-600
                                    {% else %}text-blue-600{% endif %}"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-foreground">{{ session.title }}</h3>
                                <p class="text-sm text-muted-foreground">Patient: {{ session.patient.username }}</p>
                            </div>
                        </div>

                        <p class="text-sm text-muted-foreground mt-2">{{ session.description|truncatewords:30 }}</p>

                        <div class="flex flex-wrap items-center gap-4 mt-4">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium
                                {% if session.status == 'consensus_achieved' %}bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400
                                {% elif session.status == 'in_review' %}bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400
                                {% elif session.status == 'draft' %}bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400
                                {% else %}bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400{% endif %}">
                                {{ session.get_status_display }}
                            </span>
                            <span class="text-sm text-muted-foreground">
                                <i class="fas fa-user-md mr-1"></i>{{ session.members.count }} members
                            </span>
                            <span class="text-sm text-muted-foreground">
                                <i class="fas fa-user mr-1"></i>Created by: Dr. {{ session.created_by.username }}
                            </span>
                        </div>
                    </div>

                    <div class="flex flex-col items-end space-y-2">
                        <p class="text-xs text-muted-foreground">{{ session.created_at|date:"M d, Y" }}</p>
                        {% if session.scheduled_at %}
                        <p class="text-xs text-primary">
                            <i class="fas fa-calendar mr-1"></i>{{ session.scheduled_at|date:"M d, Y H:i" }}
                        </p>
                        {% endif %}
                        <a href="{% url 'clinical_decision_support:tumor_board_detail' session.id %}" 
                           class="px-4 py-2 bg-primary/10 text-primary rounded-lg hover:bg-primary/20 transition-colors text-sm font-medium">
                            View Session <i class="fas fa-arrow-right ml-2"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="bg-card border border-border/50 rounded-xl p-12 text-center">
                <i class="fas fa-users-medical text-4xl text-muted-foreground/50 mb-4"></i>
                <h3 class="text-lg font-semibold text-foreground mb-2">No Tumor Board Sessions</h3>
                <p class="text-muted-foreground mb-4">Create a tumor board session to collaborate with other specialists.</p>
                <a href="{% url 'clinical_decision_support:tumor_board_create' %}" 
                   class="inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Create First Session
                </a>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div class="mt-6 flex justify-center">
            <nav class="flex items-center space-x-2">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-2 border border-border rounded-lg hover:bg-accent transition-colors">
                    <i class="fas fa-chevron-left"></i>
                </a>
                {% endif %}
                <span class="px-4 py-2 text-sm text-muted-foreground">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                </span>
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-2 border border-border rounded-lg hover:bg-accent transition-colors">
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
