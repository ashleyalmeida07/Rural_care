{% extends 'base.html' %}

{% block title %}Upload Image for Analysis{% endblock %}

{% block content %}
<div class="fade-in max-w-5xl mx-auto">
    <div class="mb-8 sm:mb-12">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-foreground mb-3">Upload Image for Analysis</h1>
        <p class="text-base sm:text-lg text-muted-foreground">Upload X-ray, CT scan, MRI, or tumor images for advanced OpenCV-based cancer detection and analysis</p>
    </div>

    <div class="bg-card border border-border/50 rounded-2xl p-6 sm:p-10 transition-all">
        <form method="post" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}
            
            <!-- Image Type Selection -->
            <div>
                <label for="image_type" class="block text-sm sm:text-base font-semibold text-foreground mb-3">
                    <i class="fas fa-image mr-2 text-primary"></i>Select Image Type
                </label>
                <select name="image_type" id="image_type" required class="w-full px-4 py-3 bg-background border border-input rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-foreground transition-all">
                    {% for value, label in image_types %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
                <p class="mt-2 text-xs sm:text-sm text-muted-foreground">Select the type of medical image you're uploading for accurate analysis</p>
            </div>

            <!-- File Upload -->
            <div>
                <label for="image" class="block text-sm sm:text-base font-semibold text-foreground mb-3">
                    <i class="fas fa-file-upload mr-2 text-primary"></i>Upload Image
                </label>
                <div class="mt-2 flex justify-center px-4 sm:px-6 pt-6 sm:pt-8 pb-6 sm:pb-8 border-2 border-dashed border-border rounded-xl hover:border-primary hover:bg-accent/20 transition-all duration-300 bg-accent/5 cursor-pointer group">
                    <div class="space-y-2 sm:space-y-3 text-center w-full">
                        <i class="fas fa-cloud-upload-alt text-5xl sm:text-6xl text-primary/40 group-hover:text-primary/60 mx-auto block mb-3 transition-colors"></i>
                        <div class="flex flex-col text-sm sm:text-base text-muted-foreground justify-center items-center">
                            <label for="image" class="relative cursor-pointer bg-primary/10 rounded-lg font-semibold text-primary hover:bg-primary/20 hover:text-primary/80 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary px-3 py-2 transition-all">
                                <span>Upload a file</span>
                                <input id="image" name="image" type="file" accept="image/*" required class="sr-only">
                            </label>
                            <p class="mt-2">or drag and drop</p>
                        </div>
                        <p class="text-xs text-muted-foreground/80">PNG, JPG, JPEG, BMP, TIFF up to 10MB</p>
                    </div>
                </div>
                <div id="image-preview" class="mt-6 hidden">
                    <p class="text-sm font-semibold text-foreground mb-3">Image Preview:</p>
                    <img id="preview-img" src="" alt="Preview" class="max-w-full h-auto rounded-xl border border-border/50 shadow-lg">
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex flex-col sm:flex-row gap-4 pt-4">
                <button type="submit" class="flex-1 bg-gradient-to-r from-primary to-primary/90 hover:shadow-xl text-primary-foreground font-bold py-3 sm:py-4 px-6 rounded-lg transition-all duration-300 flex items-center justify-center hover:scale-105">
                    <i class="fas fa-brain mr-2"></i>
                    Analyze Image
                </button>
                <a href="{% url 'cancer_detection:dashboard' %}" class="bg-card border-2 border-border hover:border-primary text-foreground font-bold py-3 sm:py-4 px-6 rounded-lg transition-all duration-300 flex items-center justify-center">
                    <i class="fas fa-times mr-2"></i>
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Information Box -->
    <div class="mt-8 bg-gradient-to-br from-blue-50 to-blue-50/50 dark:from-blue-900/20 dark:to-blue-900/10 border border-blue-200 dark:border-blue-800/50 rounded-xl p-6 sm:p-8">
        <h3 class="text-lg sm:text-xl font-bold text-blue-900 dark:text-blue-300 mb-4 flex items-center">
            <i class="fas fa-info-circle mr-2"></i>
            How Our Analysis Works
        </h3>
        <ul class="space-y-3 text-blue-800 dark:text-blue-200 text-sm sm:text-base">
            <li class="flex items-start">
                <i class="fas fa-check-circle text-blue-600 dark:text-blue-400 mr-3 mt-1 flex-shrink-0"></i>
                <span><strong>Edge Detection:</strong> Identifies tumor boundaries and edges in medical images</span>
            </li>
            <li class="flex items-start">
                <i class="fas fa-check-circle text-blue-600 dark:text-blue-400 mr-3 mt-1 flex-shrink-0"></i>
                <span><strong>Contour Analysis:</strong> Analyzes tumor shape, size, and morphology</span>
            </li>
            <li class="flex items-start">
                <i class="fas fa-check-circle text-blue-600 dark:text-blue-400 mr-3 mt-1 flex-shrink-0"></i>
                <span><strong>Texture Analysis:</strong> Examines tissue characteristics and patterns</span>
            </li>
            <li class="flex items-start">
                <i class="fas fa-check-circle text-blue-600 dark:text-blue-400 mr-3 mt-1 flex-shrink-0"></i>
                <span><strong>Classification:</strong> Provides tumor type, staging, and genetic profile indicators</span>
            </li>
            <li class="flex items-start">
                <i class="fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400 mr-3 mt-1 flex-shrink-0"></i>
                <span><strong>Clinical Use:</strong> This is a demonstration system. Always consult with medical professionals for actual diagnosis and treatment decisions.</span>
            </li>
        </ul>
    </div>
</div>

{% block extra_js %}
<script>
    // Image preview with drag and drop
    const imageInput = document.getElementById('image');
    const previewDiv = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    const uploadArea = imageInput.closest('div').parentElement;

    function handleImageSelect(file) {
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewDiv.classList.remove('hidden');
                uploadArea.classList.add('border-primary', 'bg-primary/5');
            };
            reader.readAsDataURL(file);
        }
    }

    imageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) handleImageSelect(file);
    });

    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('border-primary', 'bg-primary/10');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('border-primary', 'bg-primary/10');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('border-primary', 'bg-primary/10');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            imageInput.files = files;
            handleImageSelect(files[0]);
        }
    });
</script>
{% endblock %}
{% endblock %}

