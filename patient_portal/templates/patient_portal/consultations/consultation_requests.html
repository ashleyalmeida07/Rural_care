{% extends 'base.html' %}
{% block title %}My Consultation Requests{% endblock %}

{% block content %}
<div class="min-h-screen bg-background py-8 fade-in">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mb-8">
            <nav class="mb-4">
                <a href="{% url 'patient_portal:available_doctors' %}" class="text-primary hover:underline text-sm">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Doctors
                </a>
            </nav>
            <h1 class="text-3xl font-bold text-foreground">My Consultation Requests</h1>
        </div>

        <!-- Requests List -->
        <div class="space-y-4">
            {% for request in page_obj %}
            <div class="bg-card border border-border/50 rounded-xl p-6">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold text-foreground">
                            Dr. {{ request.doctor.first_name }} {{ request.doctor.last_name }}
                        </h3>
                        <p class="text-sm text-muted-foreground mt-1">{{ request.get_consultation_type_display }}</p>
                        <p class="text-sm text-foreground mt-2">{{ request.reason }}</p>
                        
                        <!-- Status Badge -->
                        <span class="inline-flex items-center px-3 py-1 mt-3 rounded-full text-xs font-medium
                            {% if request.status == 'pending' %}bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400
                            {% elif request.status == 'accepted' %}bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400
                            {% elif request.status == 'scheduled' %}bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400
                            {% elif request.status == 'rejected' %}bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400
                            {% endif %}">
                            {{ request.get_status_display }}
                        </span>
                        
                        <!-- Suggested Times (if accepted) -->
                        {% if request.status == 'accepted' and request.suggested_times %}
                        <div class="mt-4 p-4 bg-accent/30 rounded-lg">
                            <p class="font-medium text-sm mb-2">Doctor's suggested times:</p>
                            <form method="post" action="{% url 'patient_portal:accept_suggested_time' request.id %}">
                                {% csrf_token %}
                                <div class="space-y-2">
                                    {% for time in request.suggested_times %}
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="radio" name="selected_time" value="{{ time }}" required
                                               class="text-primary focus:ring-primary">
                                        <span class="text-sm text-foreground">{{ time }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                                <button type="submit" class="mt-3 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90">
                                    Confirm Time
                                </button>
                            </form>
                        </div>
                        {% endif %}
                        
                        {% if request.doctor_notes %}
                        <p class="mt-3 text-sm text-muted-foreground">
                            <strong>Doctor's Note:</strong> {{ request.doctor_notes }}
                        </p>
                        {% endif %}
                    </div>
                    
                    <div class="text-right">
                        <p class="text-xs text-muted-foreground">{{ request.requested_at|date:"M d, Y" }}</p>
                        <p class="text-xs text-muted-foreground">{{ request.requested_at|time:"g:i A" }}</p>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="bg-card border border-border/50 rounded-xl p-12 text-center">
                <i class="fas fa-calendar-times text-4xl text-muted-foreground mb-4"></i>
                <h3 class="text-lg font-medium text-foreground mb-2">No Requests Yet</h3>
                <p class="text-muted-foreground mb-4">Start by finding a doctor and requesting a consultation</p>
                <a href="{% url 'patient_portal:available_doctors' %}" 
                   class="inline-flex items-center px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90">
                    <i class="fas fa-search mr-2"></i>Find Doctors
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
